{% extends 'base.html' %}
{% block title %}Painel do Usuário{% endblock %}
{% block content %}
<section class="hero-card">
    <div>
        <p class="eyebrow">Checklist Diário</p>
        <div style="display: flex; align-items: center; gap: 12px;">
            <h2>Olá, {{ current_user.nome }}!</h2>
            <a href="{{ url_for('logout') }}" title="Sair" style="opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
            </a>
        </div>
        {% if open_trip %}
            <p>Finalize a viagem em andamento antes de iniciar uma nova saída.</p>
        {% else %}
            <p>Registre um novo relatório de partida antes de iniciar o trajeto.</p>
        {% endif %}
    </div>
    <div class="hero-actions">
        {% if open_trip %}
            <a class="btn btn-primary btn-large" href="{{ url_for('finalizar_relatorio') }}">Finalizar viagem</a>
            <a class="btn btn-ghost" href="{{ url_for('registrar_abastecimento') }}">Registrar abastecimento</a>
            <a class="btn" href="{{ url_for('registrar_avaria') }}" style="background-color: #dc2626; color: white;">Registrar avaria</a>
        {% else %}
            <a class="btn btn-primary btn-large" href="{{ url_for('novo_relatorio') }}">Novo relatório</a>
            <a class="btn btn-ghost" href="{{ url_for('registrar_abastecimento') }}">Registrar abastecimento</a>
            <a class="btn" href="{{ url_for('registrar_avaria') }}" style="background-color: #dc2626; color: white;">Registrar avaria</a>
        {% endif %}
    </div>
</section>

{% if open_trip %}
    {% set partida = (open_trip.relatorio_partida or open_trip.relatorio or {}) %}
    {% set cab = partida.cabecalho or {} %}
    <section class="card trip-status">
        <header class="section-header">
            <h3>Viagem em andamento</h3>
            <p>Você está com o veículo {{ open_trip_vehicle.modelo if open_trip_vehicle else cab.modelo }}.</p>
        </header>
        <div class="trip-grid">
            <article>
                <span class="label">Veículo</span>
                <strong>{{ (open_trip_vehicle.modelo ~ ' · ' ~ open_trip_vehicle.placa) if open_trip_vehicle else (cab.modelo ~ ' · ' ~ cab.placa) }}</strong>
            </article>
            <article>
                <span class="label">Saída</span>
                <strong>{{ cab.data_saida or '-' }} · {{ cab.hora_saida or '-' }}</strong>
            </article>
            <article>
                <span class="label">KM inicial</span>
                <strong>{{ cab.km_inicial or '-' }}</strong>
            </article>
            <article>
                <span class="label">Combustível</span>
                <strong>{{ (partida.combustivel.saida if partida.combustivel else None) or '-' }}</strong>
            </article>
        </div>
    </section>
{% endif %}
{% endblock %}
